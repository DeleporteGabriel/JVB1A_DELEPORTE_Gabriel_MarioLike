<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" /><title>Mon 3eme jeu Phaser</title>
    <script src="phaser.min.js">

    </script>

    </script>

    <style type="text/css"> body 
    
        { margin: 0; }
    
    </style>
</head>
<body>
<script type="text/javascript">


class sceneTest extends Phaser.Scene{
    constructor(){
        super('sceneTest');
    }

        preload(){

            //vies 
            this.load.image('Vie5', 'assets/sel plein.png');
            this.load.image('Vie4', 'assets/sel presque plein.png');
            this.load.image('Vie3', 'assets/sel moitié plein.png');
            this.load.image('Vie2', 'assets/sel moitié vide.png');
            this.load.image('Vie1', 'assets/sel presque vide.png');
            this.load.image('Vie0', 'assets/sel vide.png');

            //marcel
            this.load.image('MarcelIdle', 'assets/Marcel idle2.png');
            this.load.image('plateformeTest', 'assets/plateforme test.png');
            this.load.image('background', 'assets/fond tile.png');

            this.load.image('fireblast', 'assets/le FEU.png')
            this.load.image('grosFeu', 'assets/FEU.png')
            this.load.image('jaugeFeu', 'assets/leFEU3.png')
            this.load.image('feuMural', 'assets/feuVerticale.png')
            this.load.image('rechargeFeu', 'assets/flamebleu.png');

            this.load.spritesheet('marcel_walk', 'assets/Marcel run left.png',
            { frameWidth: 600, frameHeight: 600 });

            this.load.spritesheet('marcel_eyeattack', 'assets/Marcel FireBlast.png',
            { frameWidth: 600, frameHeight: 600 });
            this.load.spritesheet('rouedefeu', 'assets/rouedefeu spritesheet cette fois.png',
            { frameWidth: 600, frameHeight: 600 });
            this.load.spritesheet('marcel_kisaute', 'assets/Marcel qui saute.png',
            { frameWidth: 600, frameHeight: 600 });

            this.load.spritesheet('fire_up', 'assets/fireUp.png',
            { frameWidth: 600, frameHeight: 600 });

            //ennemy
            this.load.image('francois', 'assets/placeholder_mechant.png');
            this.load.spritesheet('francoisTP', 'assets/tpFrancois.png',
            { frameWidth: 300, frameHeight: 300 });

            this.load.image('francoisTableauVert', 'assets/cadreVert.png');
            this.load.image('francoisTableauRouge', 'assets/cadreRouge.png');

            this.load.spritesheet('francois2', 'assets/francois1erSpritesheet.png',
            {frameWidth :300, frameHeight: 300});

            this.load.image('francoisBuste', 'assets/buste.png');
            this.load.image('francoisLazer', 'assets/superLazer.png');

            this.load.spritesheet('origami', 'assets/origaMarcel spritesheet.png',
            {frameWidth :300, frameHeight: 300});


            //cheminees
            this.load.image('chemineeEteinte', 'assets/chemineeeteinte.png');
            this.load.image('chemineeAllumee', 'assets/chemineeallume.png');

            this.load.image('jesuisboogie', 'assets/candle.png');

            this.load.image('particule', 'assets/particules.png')
            this.load.image('particles', 'assets/smoke.png')

            //collisions tiled
            this.load.image("Phaser_Collision", "assets/tileset_chambord.png");
            this.load.tilemapTiledJSON("carte", "assets/tiled_export.json");
            this.load.image('image_fond', 'assets/fond tile.png')

            this.load.image('lefond', 'assets/fond ciel.png');

            //rickroll
            this.load.spritesheet('Rickroll_spritesheet', 'assets/rickroll spritesheet.png',
            { frameWidth: 498, frameHeight: 373 });
        }

        create(){

            this.fond = this.add.image(3400, 1500, 'lefond');
            this.fond.setScrollFactor(0.1);



            //COLLISIONS//
            const carteDuNiveau = this.add.tilemap("carte");

            // importer TileSet 
            const tileset = carteDuNiveau.addTilesetImage(
                    "tileset_chambord",
                    "Phaser_Collision"
                    );       
            const bababackground = carteDuNiveau.createLayer(
                    "layer_background",
                    tileset
                );
            const FondDeco = carteDuNiveau.createLayer(
                    "deco_fond",
                    tileset
                );          
            const PremierDeco = carteDuNiveau.createLayer(
                    "deco_pasfond",
                    tileset
                ); 
            const wallFire = carteDuNiveau.createLayer(
                    "layer_fire",
                    tileset
                );
            
            wallFire.setCollisionByProperty({ solide: true });
            wallFire.visible = false;

            //tableau

            this.tableauEnnemis = this.physics.add.group()

            carteDuNiveau.getObjectLayer('layer_spawnTableau').objects.forEach((tableauEnnemis) => {
            this.tableau = this.tableauEnnemis.create(tableauEnnemis.x, tableauEnnemis.y, 'francoisTableauVert');
            this.tableau.setVelocityX(1000);
            });

            //cheminée
            this.chemineeDroite = this.physics.add.sprite(170*300, (23*300) + 150, 'chemineeEteinte');
            this.chemineeGauche = this.physics.add.sprite(10*300, (23*300) + 150, 'chemineeEteinte');
            this.chemineeFinale = this.physics.add.sprite(90*300, (3*300) + 150, 'chemineeEteinte');

            //PARTICULES//
            //cheminée
            this.sparkSpawn = this.add.particles('particule').createEmitter({
                alpha: { start: 1, end: 0 },
                scale: { start: 3, end: 7.5 },
                //tint: { start: 0xff945e, end: 0xff945e },
                speed: 60,
                accelerationY: -900,
                angle: { min: -85, max: -95 },
                rotate: { min: -180, max: 180 },
                lifespan: { min: 1000, max: 1100 },
                blendMode: 'ADD',
                frequency: 30,
                //maxParticles: 10,
                x: {min: 90*300 - 200, max: 90*300 + 200},
                y: 98*300 + 200
            });

            this.sparkRoue = this.add.particles('particule').createEmitter({
                alpha: { start: 1, end: 0 },
                scale: { start: 3, end: 7.5 },
                //tint: { start: 0xff945e, end: 0xff945e },
                speed: 60,
                accelerationY: -900,
                angle: { min: -85, max: -95 },
                rotate: { min: -180, max: 180 },
                lifespan: { min: 1000, max: 1100 },
                blendMode: 'ADD',
                frequency: 30,
                //maxParticles: 10,
                x: {min: 170*300 - 200, max: 170*300 + 200},
                y: 25*300 + 200
            });

            this.sparkBoule = this.add.particles('particule').createEmitter({
                alpha: { start: 1, end: 0 },
                scale: { start: 3, end: 7.5 },
                //tint: { start: 0xff945e, end: 0xff945e },
                speed: 60,
                accelerationY: -900,
                angle: { min: -85, max: -95 },
                rotate: { min: -180, max: 180 },
                lifespan: { min: 1000, max: 1100 },
                blendMode: 'ADD',
                frequency: 30,
                //maxParticles: 10,
                x: {min: 10*300 - 200, max: 10*300 + 200},
                y: 25*300 + 200
            });

            this.sparkRoue.active = false;
            this.sparkBoule.active = false;

            this.noussommesboogie = this.physics.add.group();
            //bougies
            carteDuNiveau.getObjectLayer('layer_bougie').objects.forEach((spawner) => {
                this.bougie = this.noussommesboogie.create(spawner.x, spawner.y - 150, 'jesuisboogie');
                this.bougie.health = 1;
            });
            //PARTICULES//

            //PLAYER//
            this.cursors = this.input.keyboard.createCursorKeys();

            this.playerPosition = 0;

            this.player = this.physics.add.sprite(90*300,  2*300, 'MarcelIdle');
            //this.player = this.physics.add.sprite(90*300,  98*300, 'MarcelIdle');
            this.playerSpawnX = 90*300;
            this.playerSpawnY = 98*300;
            this.player.setGravityY(10000);
            this.player.setSize(350, 550)
            this.player.setOffset(125, 50)  
            this.player.body.setMaxVelocity(9999, 4000);

            this.attaquePlayer = false;
            this.timerAttack = 0;
            this.doubleJump = true;
            this.fireDash = true;
            this.grimpe = false;
            this.rouedefeu = false;

            this.superfusee = false;
            this.fireJump = 0;

            //animation
            this.anims.create({
                key: 'MarcelLeftRun',
                frames: this.anims.generateFrameNumbers('marcel_walk', {start:0,end:3}),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'MarcelAttak',
                frames: this.anims.generateFrameNumbers('marcel_eyeattack', {start:0,end:3}),
                frameRate: 5,
                repeat: -1
            });
            this.anims.create({
                key: 'RoueFeu',
                frames: this.anims.generateFrameNumbers('rouedefeu', {start:0,end:3}),
                frameRate: 20,
                repeat: -1
            });
            this.anims.create({
                key: 'BouleFeu',
                frames: this.anims.generateFrameNumbers('fire_up', {start:0,end:1}),
                frameRate: 20,
                repeat: -1
            });
            this.anims.create({
                key: 'MarcelJump',
                frames: this.anims.generateFrameNumbers('marcel_kisaute', {start:0,end:3}),
                frameRate: 20,
                repeat: -1
            });
            //ennemis
            this.anims.create({
                key: 'francoisMarche',
                frames: this.anims.generateFrameNumbers('francois2', {start:0,end:1}),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'francoisSeTP',
                frames: this.anims.generateFrameNumbers('francoisTP', {start:0,end:5}),
                frameRate: 10,
                repeat: -1
            });
            this.anims.create({
                key: 'OrigaMarcel',
                frames: this.anims.generateFrameNumbers('origami', {start:0,end:1}),
                frameRate: 5,
                repeat: -1
            });

            //FEU
            //murs
            carteDuNiveau.getObjectLayer('layer_particles').objects.forEach((spawner) => {
                this.sparkPorte0 = this.add.particles('particles').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 2.5, end: 5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 400,
                    accelerationY: -900,
                    angle: { min: -85, max: -95 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    //blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: {min: spawner.x - 150, max: spawner.x + 150},
                    y: spawner.y
                });
                this.sparkPorte1 = this.add.particles('particule').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 3, end: 7.5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 400,
                    accelerationY: -900,
                    angle: { min: -85, max: -95 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: {min: spawner.x - 150, max: spawner.x + 150},
                    y: spawner.y
                });
            });

            //sol
            carteDuNiveau.getObjectLayer('layer_particles_H').objects.forEach((spawner) => {
                this.sparkPorte2 = this.add.particles('particles').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 2.5, end: 5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 1400,
                    accelerationX: -500,
                    angle: { min: -5, max: 5 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    //blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: spawner.x + 150,
                    y: {min: spawner.y - 170, max: spawner.y - 130}
                });
                this.sparkPorte3 = this.add.particles('particule').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 3, end: 7.5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 1400,
                    accelerationX: -500,
                    angle: { min: -5, max: 5 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: spawner.x + 150,
                    y: {min: spawner.y - 170, max: spawner.y - 130}
                });
            });

            carteDuNiveau.getObjectLayer('layer_particles_HD').objects.forEach((spawner) => {
                this.sparkPorte2 = this.add.particles('particles').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 2.5, end: 5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 1400,
                    accelerationX: -500,
                    angle: { min: 185, max: 175 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    //blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: spawner.x + 150,
                    y: {min: spawner.y - 170, max: spawner.y - 130}
                });
                this.sparkPorte3 = this.add.particles('particule').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 3, end: 7.5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 1400,
                    accelerationX: -500,
                    angle: { min: 185, max: 175 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 1000, max: 1100 },
                    blendMode: 'ADD',
                    frequency: 15,
                    //maxParticles: 10,
                    x: spawner.x + 150,
                    y: {min: spawner.y - 170, max: spawner.y - 130}
                });
            });

            //attack
            this.sparkAttaqueSmoke = this.add.particles('particles').createEmitter({
                alpha: { start: 1, end: 0 },
                scale: { start: 2, end: 5 },
                //tint: { start: 0xff945e, end: 0xff945e },
                speed: 60,
                accelerationY: -900,
                angle: { min: -85, max: -95 },
                rotate: { min: -180, max: 180 },
                lifespan: { min: 1000, max: 1100 },
                //blendMode: 'ADD',
                frequency: 30,
                //maxParticles: 10,
            });
            this.sparkAttaque = this.add.particles('particule').createEmitter({
                alpha: { start: 1, end: 0 },
                scale: { start: 3, end: 7.5 },
                //tint: { start: 0xff945e, end: 0xff945e },
                speed: 60,
                accelerationY: -900,
                angle: { min: -85, max: -95 },
                rotate: { min: -180, max: 180 },
                lifespan: { min: 1000, max: 1100 },
                blendMode: 'ADD',
                frequency: 30,
                //maxParticles: 10,
            });

            this.sparkAttaque.setPosition(0, 0);
            this.sparkAttaqueSmoke.setPosition(0, 0);

            this.fired = this.physics.add.group();
            this.firedGround = this.physics.add.group();
            this.firedWall  = this.physics.add.group();
            this.flameDispo = 0;
            this.flameDirection = 0;

            function firedCreate(fire, wall) {

                if (this.flameDirection == 0) {
                    this.sparkAttaque.setPosition({min: fire.x - 300, max: fire.x + 300}, fire.y + 100);
                    this.sparkAttaqueSmoke.setPosition({min: fire.x - 300, max: fire.x + 300}, fire.y + 100);
                    fire.destroy();

                    this.grosFeu = this.firedGround.create(fire.x, fire.y - 150, 'grosFeu');
                    this.grosFeu.visible = false;
                    this.grosFeu.health = 100;
                }
                else {
                    if (this.flameDirection == 1) {
                        this.sparkAttaque.setPosition(fire.x + 150, {min : fire.y - 100, max: fire.y + 100});
                        this.sparkAttaqueSmoke.setPosition(fire.x + 150, {min : fire.y - 100, max: fire.y + 100});
                        fire.destroy();

                        this.grosFeu = this.firedWall.create(fire.x + 150, fire.y, 'feuMural');
                        this.grosFeu.visible = false;
                        this.grosFeu.health = 100;
                    }
                    else if (this.flameDirection == 2) {
                        this.sparkAttaque.setPosition(fire.x - 150, {min : fire.y - 100, max: fire.y + 100});
                        this.sparkAttaqueSmoke.setPosition(fire.x - 150, {min : fire.y - 100, max: fire.y + 100});
                        fire.destroy();

                        this.grosFeu = this.firedWall.create(fire.x - 150, fire.y, 'feuMural');
                        this.grosFeu.visible = false;
                        this.grosFeu.health = 100;
                    }
                }
            }


            function fireAllume(cheminee, fire) {
                fire.destroy();
                this.sparkRoue.active = true;
                if (this.rouedefeu == false) {
                    this.playerSpawnX = cheminee.x;
                    this.playerSpawnY = cheminee.y + 300;
                    this.rouedefeu = true;
                    this.pointCoeur = 5;
                    this.scene.pause();
                    this.scene.launch('sceneB', {powerup : 1});
                }
            }
            this.physics.add.collider(this.fired, this.chemineeDroite, fireAllume, null, this);

            function fireAllume2(cheminee, fire) {
                fire.destroy();
                this.sparkBoule.active = true;
                if (this.superfusee == false) {
                    this.playerSpawnX = cheminee.x;
                    this.playerSpawnY = cheminee.y + 300;
                    this.superfusee = true;
                    this.pointCoeur = 5;
                    this.scene.pause();
                    this.scene.launch('sceneB', {powerup : 2});
                }
            }
            this.physics.add.collider(this.fired, this.chemineeGauche, fireAllume2, null, this);

            function fireAllume3(cheminee, fire) {
                fire.destroy();
                this.scene.pause();
                this.scene.launch('sceneB', {powerup : 3});
            }
            this.physics.add.collider(this.fired, this.chemineeFinale, fireAllume3, null, this);

            function allumeBoogie(fire, bougie) {

            if (bougie.health == 1) {
                this.playerSpawnX = bougie.x;
                this.playerSpawnY = bougie.y - 300;
                bougie.health = 0;
                this.pointCoeur += 1;
                if (this.pointCoeur >= 5) {
                    this.pointCoeur = 5;
                }

                this.sparkBougie = this.add.particles('particles').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 1, end: 1.5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 200,
                    accelerationY: -50,
                    angle: { min: -95, max: -85 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 500, max: 550 },
                    //blendMode: 'ADD',
                    frequency: 150,
                    //maxParticles: 10,
                    x: bougie.x,
                    y: {min: bougie.y - 170, max: bougie.y - 140}
                });
                this.sparkBougie2 = this.add.particles('particule').createEmitter({
                    alpha: { start: 1, end: 0 },
                    scale: { start: 1, end: 1.5 },
                    //tint: { start: 0xff945e, end: 0xff945e },
                    speed: 200,
                    accelerationY: -50,
                    angle: { min: -95, max: -85 },
                    rotate: { min: -180, max: 180 },
                    lifespan: { min: 500, max: 550 },
                    blendMode: 'ADD',
                    frequency: 150,
                    //maxParticles: 10,
                    x: bougie.x,
                    y: {min: bougie.y - 170, max: bougie.y - 140}
                });
            }
            }

            this.physics.add.overlap(this.fired, this.noussommesboogie, allumeBoogie, null, this);
            this.physics.add.overlap(this.firedGround, this.noussommesboogie, allumeBoogie, null, this);
            this.physics.add.overlap(this.firedWall, this.noussommesboogie, allumeBoogie, null, this);

            this.physics.world.setFPS(300);

            this.wallGroupe = carteDuNiveau.createLayer(
                    "layer_walls",
                    tileset
                );
            const wallDeco = carteDuNiveau.createLayer(
                    "layer_deco",
                    tileset
                );
            this.wallTableau = carteDuNiveau.createLayer(
                    "layer_tableau",
                    tileset
                );
            this.wallGroupe.setCollisionByProperty({ solide: true });
            this.wallTableau.visible = false;

            this.physics.add.collider(this.player, this.wallGroupe);
            this.physics.add.collider(this.fired, this.wallGroupe, firedCreate, null, this);
            this.physics.add.collider(this.firedGround, this.wallGroupe);

            //CAMERA
            //VIE
            this.imageVie = this.add.image(-1800, -800, 'Vie3');
            this.imageVie.setScrollFactor(0);
            this.pointCoeur = 5;

            this.Iframe = 0;

            
            this.cameras.main.zoom = 0.225;
            //this.cameras.main.zoom = 0.025;

            this.cameras.main.setBounds(6000*5, 6000*5, 6000, 6000);
            this.cameras.main.startFollow(this.player);

            //MECHANT
            //poursuite
            this.ennemy = this.physics.add.sprite((6000*8) - 2500, (5*6000)-3000, 'francois');
            this.ennemy.setGravityY(5000);
            this.ennemySide = 0;
            this.ennemyFollow = false;

            this.ennemyTP = 0;

            this.ennemy.anims.play('francoisMarche', true);

            this.timerAttaque = 0;
            this.timerDash = 0;
            this.timerAttaque = 0;

            this.AUFEU = false;
            this.timerFeu = 0;
            this.fuiteFeu = 0;

            this.physics.add.collider(this.ennemy, this.wallGroupe);
            this.physics.add.collider(this.ennemy, wallFire);

            function OFEU(ennemy, feu) {
                this.AUFEU = true;
                if (ennemy.x <= feu.x) {this.fuiteFeu = 1;}
                else if (ennemy.x > feu.x) {this.fuiteFeu = 2;}
                else {this.fuiteFeu = 0;}
            }

            this.physics.add.overlap(this.ennemy, this.firedGround, OFEU, null, this);


            //buste

            this.busteEnnemis = this.physics.add.group()
            this.busteLazer = this.physics.add.group()

            carteDuNiveau.getObjectLayer('layer_buste').objects.forEach((busteEnnemis) => {
                this.buste = this.busteEnnemis.create(busteEnnemis.x+150, busteEnnemis.y-150, 'francoisBuste');
                this.buste.health = 0;
            });

            function degatSubit(player, lazer) {
                if (this.fireDash == true) {
                    lazer.destroy();
                    if (this.Iframe == 0){
                        this.pointCoeur -= 1;
                        this.cameras.main.shake(100, 0.7);
                        this.Iframe++;
                    }
                }
            }

            this.physics.add.overlap(this.player, this.busteLazer, degatSubit, null, this);

            //origami
            this.origamis = this.physics.add.group();

            carteDuNiveau.getObjectLayer('layer_origami').objects.forEach((busteEnnemis) => {
                this.origami = this.origamis.create(busteEnnemis.x+150, busteEnnemis.y-150, 'origami');
                this.origami.anims.play('OrigaMarcel', true);
                this.origami.setGravityY(5000);
                this.origami.body.setSize(300, 150);
                this.origami.body.setOffset(0, 150);
            });

            this.physics.add.collider(this.origamis, this.wallGroupe);

            function degatSubit2(player, origami) {
                if ((this.Iframe == 0) && (this.fireDash == true)){
                     this.pointCoeur -= 1;
                    this.cameras.main.shake(100, 0.7);
                    this.Iframe++;
                }
            }

            this.physics.add.overlap(this.player, this.origamis, degatSubit2, null, this);

            //rickroll
            /*this.anims.create({
                key: 'rickroll',
                frames: this.anims.generateFrameNumbers('Rickroll_spritesheet', {start:0,end:89}),
                frameRate: 24,
                repeat: -1
            });

            this.rickroll = this.physics.add.sprite(5000, 11000, 'Rickroll_spritesheet');
            this.rickroll.body.allowGravity = false;
            this.rickroll.body.stop();
            this.rickroll.anims.play('rickroll', true);
            this.rickroll.setScale(4);*/

            //interface 

            this.flameJauge = this.physics.add.sprite(-1200, -800, 'jaugeFeu');
            this.flameJauge.body.allowGravity = false;
            this.flameJauge.body.stop()
            this.flameJauge.setScrollFactor(0);

            this.pause = false;
            this.intro = true;
        };

        update(time, delta){
            super.update(time, delta);

            if (this.intro == true) {
                this.intro = false;
                this.scene.pause();
                this.scene.launch('sceneB', {powerup : 0});
            }

            //respawn
            if (this.pointCoeur <= 0) {
                this.pointCoeur = 5;
                this.player.x = this.playerSpawnX;
                this.player.y = this.playerSpawnY;
                this.scene.pause();
                this.scene.launch('sceneB', {powerup : 4});
            }

            //CAMERA
            for (this.i = 0; this.i < 9; this.i++) {
                for (this.j = 0; this.j < 5; this.j++) {
                    if ((this.player.x < 6000*(this.i + 1)) && (this.player.x > 6000*this.i) && (this.player.y < 6000*(this.j + 1)) && (this.player.y > 6000*this.j)) {
                        this.cameras.main.setBounds(6000*this.i, 6000*this.j, 6000, 6000);
                        this.playerPosition = this.i + (this.j*this.i);
                    }
                }
            }

            //POINT DE VIES
            if (this.pointCoeur == 5) {
                this.imageVie.setTexture('Vie5');
            }
            else if (this.pointCoeur == 4) {
                this.imageVie.setTexture('Vie4');
            }
            else if (this.pointCoeur == 3) {
                this.imageVie.setTexture('Vie3');
            } else if (this.pointCoeur == 2) {
                this.imageVie.setTexture('Vie2');
            } else if (this.pointCoeur == 1) {
                this.imageVie.setTexture('Vie1');
            } else {this.imageVie.setTexture('Vie0');}

            //CONTROLE MARCEL//
            this.jump = Phaser.Input.Keyboard.JustDown(this.cursors.up);
            this.attaqueBouton = Phaser.Input.Keyboard.JustDown(this.cursors.space);

            if (this.Iframe != 0) {
                this.Iframe++;
                this.player.setTint(0xff8888);
                if (this.Iframe >= 80) {
                    this.Iframe = 0;
                }
            } else {this.player.setTint(0xffffff);}

            if (this.attaquePlayer == false) {
                if (this.player.body.blocked.down) {
                    this.grimpe = false;
                    this.doubleJump = true;
                    this.fireDash = true;
                    this.fireJump = 0;
                }
                if (this.jump) //saut ou double saut
                {   
                    if (this.player.body.blocked.down) {
                        this.player.setVelocityY(-3000);
                    }
                    else if (this.doubleJump == true) {
                        this.player.setVelocityY(-3000);
                        this.doubleJump = false;
                    }
                } 
                if (!this.player.body.blocked.down) {if ((this.grimpe == false) && (this.fireJump != 1)) {this.player.anims.play('MarcelJump', true);} else if (this.fireJump != 1) {this.player.anims.play('MarcelLeftRun', true);}}
                //déplacement droite gauche
                if (this.fireJump != 1) {
                    if (this.cursors.left.isDown){ //si la touche gauche est appuyée
                        this.player.setVelocityX(-1800); //alors vitesse négative en X
                        if (this.player.body.blocked.down) {this.player.anims.play('MarcelLeftRun', true);}
                        this.player.flipX = false;
                    }
                    else if (this.cursors.right.isDown){ //sinon si la touche droite est appuyée
                        this.player.setVelocityX(1800); //alors vitesse positive en X
                        if (this.player.body.blocked.down) {this.player.anims.play('MarcelLeftRun', true);}
                        this.player.flipX = true;
                    }
                    else{ // sinon
                        this.player.setVelocityX(0); //vitesse nulle
                        if (this.player.body.blocked.down) {this.player.setTexture('MarcelIdle');}
                    }
                    //monter les rebords
                    if (this.player.body.blocked.right) {
                        //this.player.x += 20;
                        this.tile = this.wallGroupe.getTileAtWorldXY(this.player.x + 300, this.player.y - 300, true);
                        if (this.tile.index == -1){
                            this.player.body.y -= 150;
                            this.grimpe = true;
                        }
                    }
                    if (this.player.body.blocked.left) {
                        //this.player.x -= 20;
                        this.tile = this.wallGroupe.getTileAtWorldXY(this.player.x - 300, this.player.y - 300, true);
                        if (this.tile.index == -1){
                            this.player.body.y -= 150;
                            this.grimpe = true;
                        }
                    }
                }
                //attaquer
                if ((((!this.cursors.space.isDown) || (!this.cursors.up.isDown)) && (this.fireJump == 1)) || (this.player.body.blocked.up)) {
                    this.fireJump = 2;
                    //this.attaquePlayer = false;
                }

                if ((this.cursors.space.isDown) && (this.fireJump != 2) && (this.cursors.up.isDown) && (this.superfusee == true)) {
                        if (this.fireJump == 0) {this.player.anims.play({ key: 'BouleFeu', startFrame: 0 }, true);}    
                        this.fireJump = 1;
                        //this.attaquePlayer = true;
                        this.player.setVelocityY(-4000);
                        this.player.setVelocityX(0);
                    }
                else if (this.attaqueBouton) {
                    if ((this.flameDispo == 0) && (this.player.body.velocity.x == 0) && (!this.cursors.up.isDown)) {
                    this.flameDispo++;
                    this.attaquePlayer = true;
                    this.player.anims.play({ key: 'MarcelAttak', startFrame: 0 }, true);
                    }
                    else if ((this.fireDash == true) && (this.player.body.velocity.x != 0) && (this.rouedefeu == true)) {
                        if (this.player.body.velocity.x > 0 && !this.player.body.blocked.right) {
                            this.player.setVelocityX(4000);
                            this.fireDash = false;
                            this.attaquePlayer = true;
                        } else if (this.player.body.velocity.x < 0 && !this.player.body.blocked.left) {
                            this.player.setVelocityX(-4000);
                            this.fireDash = false;
                            this.attaquePlayer = true;
                        }
                    }
                }
            }
            else {
                this.timerAttack++;

                if (this.fireDash == true) {
                    //attaque lancer de feu
                    this.player.setVelocityX(0);
                if (this.timerAttack == 1) {
                if (this.cursors.down.isDown) {
                    this.feu = this.fired.create(this.player.x, this.player.y - 50, 'fireblast');
                        this.feu.setVelocityY(4000);
                        this.flameDirection = 0;
                }
                else {
                    if (this.player.flipX == false) {
                        this.feu = this.fired.create(this.player.x - 200, this.player.y - 50, 'fireblast');
                        this.feu.setVelocityX(-4000);
                        this.flameDirection = 2;
                    } else {
                        this.feu = this.fired.create(this.player.x + 200, this.player.y - 50, 'fireblast');
                        this.feu.setVelocityX(4000);
                        this.flameDirection = 1;
                    }
                }
                }
                if (this.timerAttack >= 40) {
                    this.attaquePlayer = false;
                    this.timerAttack = 0;
                }
            }
            else {
                this.player.anims.play('RoueFeu', true);
                this.player.setVelocityY(0);
                //dash de feu
                if (this.timerAttack >= 20) {
                    this.attaquePlayer = false;
                    this.timerAttack = 0;
                }
            }
            }

            //FEU
            if (this.flameDispo != 0) {
                this.flameDispo++;
                this.flameJauge.alpha = this.flameDispo/200;
                this.flameJauge.setTexture('rechargeFeu');
                if (this.flameDispo >= 150) {
                    this.flameDispo = 0;
                    this.flameJauge.alpha = 1;
                    this.flameJauge.setTexture('jaugeFeu');
                }
            }

            this.firedGround.children.each(function(feu) {
                feu.health -= 1;
                if (feu.health < 40) {feu.alpha -= 0.05;}
                if (feu.health <= 0) {
                    this.sparkAttaque.setPosition(0, 0);
                    this.sparkAttaqueSmoke.setPosition(0, 0);
                    feu.destroy();
                }
            }, this);

            this.firedWall.children.each(function(feu) {
                feu.health -= 1;
                if (feu.health < 40) {feu.alpha -= 0.05;}
                if (feu.health <= 0) {
                    this.sparkAttaque.setPosition(0, 0);
                    this.sparkAttaqueSmoke.setPosition(0, 0);
                    feu.destroy();
                }
            }, this);

            //MECHANT PATTERN
            if (Phaser.Math.Distance.BetweenPoints(this.player, this.ennemy) < 3000) {this.ennemyFollow = true;}

            if (this.ennemyTP != 0) {
                this.ennemyTP++;
                if (this.ennemyTP >= 30) {
                    this.ennemyTP = 0;
                    this.ennemy.setGravityY(5000);
                    this.ennemy.anims.play('francoisMarche', true);
                }
            }

            if (this.ennemyFollow == true && this.ennemyTP == 0) {

            if (this.AUFEU == false) {
            if (this.timerDash == 0) {

                if (this.ennemySide == 0 && (this.ennemy.y > this.player.y + 300)) {
                    for (this.i = 0; this.i < 5; this.i++) {
                    this.tile = this.wallGroupe.getTileAtWorldXY(this.ennemy.x, this.ennemy.y - 300*this.i, true);
                    if (this.tile != null) {
                    if (this.tile.index != -1){
                        this.ennemySide = 1;
                        this.ennemy.setGravityY(-5000);
                        this.ennemy.flipY = true;
                    }}
                }
                }
                if (this.ennemySide == 1 && (this.ennemy.y < this.player.y - 300)) {
                    for (this.i = 0; this.i < 5; this.i++) {
                    this.tile = this.wallGroupe.getTileAtWorldXY(this.ennemy.x, this.ennemy.y + 300*this.i, true);
                    if (this.tile != null) {
                    if (this.tile.index != -1){
                        this.ennemySide = 0;
                        this.ennemy.setGravityY(5000);
                        this.ennemy.flipY = false;
                    }}
                }
                }
                if ((this.ennemy.y > this.player.y + 100) || (this.ennemy.y < this.player.y - 300)) {
                    if ((this.ennemy.x < this.player.x - 300)) {
                        this.ennemy.setVelocityX(1200);
                        this.timerAttaque = 0;
                    }
                    else if ((this.ennemy.x > this.player.x + 300)) {
                        this.ennemy.setVelocityX(-1200);
                        this.timerAttaque = 0;
                    }
                    else {this.ennemy.setVelocityX(0); this.timerAttaque++;}
                }
                else {                
                    if ((this.ennemy.x < this.player.x - 600)) {
                        this.ennemy.setVelocityX(1200);
                        this.dashEnnemyDirection = 0;
                        this.timerAttaque = 0;
                    }
                    else if ((this.ennemy.x > this.player.x + 600)) {
                        this.ennemy.setVelocityX(-1200);
                        this.dashEnnemyDirection = 1;
                        this.timerAttaque = 0;
                    }
                    else {this.ennemy.setVelocityX(0); this.timerAttaque++;}
                }

            }
            if (this.timerAttaque >= 20) {
                this.timerAttaque = 0;
                this.timerDash++;
                if (this.dashEnnemyDirection == 0) {
                    this.ennemy.setVelocityX(3000);
                }
                else if (this.dashEnnemyDirection == 1) {
                    this.ennemy.setVelocityX(-3000);
                }
            }
            if (this.timerDash != 0) {
                this.timerDash++;
                this.ennemy.setVelocityY(0);
                if (this.timerDash >= 25) {
                    this.timerDash = 0;
                    this.ennemy.setVelocityX(0);
                    if (this.dashEnnemyDirection == 0) {
                        this.dashEnnemyDirection = 1;
                    } else if (this.dashEnnemyDirection == 1) {
                        this.dashEnnemyDirection = 0;
                    }
                }

                if ((this.fireDash == true) && (this.player.x > this.ennemy.x - 300) && (this.player.x < this.ennemy.x + 300)
                && (this.player.y > this.ennemy.y - 300) && (this.player.y < this.ennemy.y + 300) && (this.Iframe == 0))
                    {
                    this.pointCoeur -= 1;
                    this.cameras.main.shake(100, 0.7);
                    this.Iframe++;
                }

            }
            } else {
                this.timerFeu++;
                if (this.timerFeu >= 50) {this.timerFeu = 0; this.AUFEU = false; this.fuiteFeu = 0;}

                if (this.fuiteFeu == 1) {this.ennemy.setVelocityX(-4000);}
                else if (this.fuiteFeu == 2) {this.ennemy.setVelocityX(4000);}
            }
            if ((this.ennemy.body.blocked.right) || (this.ennemy.body.blocked.left)) {
                if (this.ennemySide == 0) {
                    this.ennemy.setVelocityY(-2000);
                } else {this.ennemy.setVelocityY(2000);}
            }
        }

            //Tableaux


            this.tableauEnnemis.children.each(function(enemy) {

                //prise de degat
                if ((this.player.x > enemy.x - 300) && (this.player.x < enemy.x + 300)
                && (this.player.y > enemy.y - 300) && (this.player.y < enemy.y + 300) && (this.Iframe == 0) && (this.fireDash == true)) {
                    this.pointCoeur -= 1;
                    this.cameras.main.shake(100, 0.7);
                    this.Iframe++;
                }

                this.tile = this.wallTableau.getTileAtWorldXY(enemy.x, enemy.y, true);
                        if (this.tile.index != -1){
                        if (enemy.body.velocity.x > 0) {
                            enemy.x -= 50;
                            enemy.setVelocityX(-1000);
                        }
                        else if (enemy.body.velocity.x < 0) {
                            enemy.setVelocityX(1000);
                            enemy.x += 50;
                        }
                }
            if (Phaser.Math.Distance.BetweenPoints(this.player, enemy) < 1000) {
                enemy.setTexture('francoisTableauRouge');

                if (Phaser.Math.Distance.BetweenPoints(this.player, this.ennemy) > 2400)
                {
                    this.ennemy.x = enemy.x;
                    this.ennemy.y = enemy.y;
                    this.ennemy.ennemySide = 0;
                    this.ennemy.setGravityY(0);
                    this.ennemy.setVelocityY(0);
                    this.ennemy.setVelocityX(0);
                    this.ennemy.flipY = false;
                    this.ennemyTP++;
                    this.ennemy.anims.play('francoisSeTP', true);
                }
            } else {enemy.setTexture('francoisTableauVert');}
        }, this);

        //bustes

        this.busteEnnemis.children.each(function(buste) {
        for (this.i = 0; this.i < 9; this.i++) {
            for (this.j = 0; this.j < 5; this.j++) {
                if ((buste.x < 6000*(this.i + 1)) && (buste.x > 6000*this.i) && (buste.y < 6000*(this.j + 1)) && (buste.y > 6000*this.j)) {
                    this.bustePosition = this.i + (this.j*this.i);
                }
            }
        }


        if ((Phaser.Math.Distance.BetweenPoints(this.player, buste) < 2500) && (buste.health == 0) && (this.bustePosition == this.playerPosition)) {
            this.lazer = this.busteLazer.create(buste.x, buste.y, 'francoisLazer');
            this.physics.moveTo(this.lazer, this.player.x, this.player.y, 1000);
            this.lazer.rotation = Phaser.Math.Angle.BetweenPoints(this.lazer, this.player)
            buste.health++;
        }
        if (buste.health != 0) {
            buste.health++;
            if (buste.health >= 100) {
                buste.health = 0;
            }
        }
        if (this.player.x < buste.x) {buste.flipX = false;} else {buste.flipX = true;}
        }, this);

        this.busteLazer.children.each(function(buste) {
        for (this.i = 0; this.i < 9; this.i++) {
            for (this.j = 0; this.j < 5; this.j++) {
                if ((buste.x < 6000*(this.i + 1)) && (buste.x > 6000*this.i) && (buste.y < 6000*(this.j + 1)) && (buste.y > 6000*this.j)) {
                    this.bustePosition = this.i + (this.j*this.i);
                }
            }
        }
        if (this.playerPosition != this.bustePosition) {
            buste.destroy();
        }
    }, this);

        //origamis
        this.origamis.children.each(function(enemy) {
            if (this.player.x < enemy.x) {enemy.flipX = false;} else {enemy.flipX = true;}
            if ((this.jump) && (enemy.body.blocked.down)) {
                enemy.setVelocityY(-2000);
            }
        }, this);
 
        };
}

class sceneB extends Phaser.Scene{
    constructor(){
        super('sceneB');
    }

    init(data) {
        this.powerup = data.powerup;
    }

preload() {
    this.load.spritesheet("animRoueFeu", "assets/BD/spritesheet roue de feu.png", {frameWidth :600, frameHeight:338});
    this.load.spritesheet("animBouleFeu", "assets/BD/spritesheet boule de feu.png", {frameWidth :600, frameHeight: 338});
    this.load.spritesheet("animIntro", "assets/BD/spritesheet intro 2.png", {frameWidth :600, frameHeight: 338});
    this.load.spritesheet("animDCD", "assets/BD/spritesheet dcd.png", {frameWidth :600, frameHeight: 338});
    this.load.spritesheet("animVictoire", "assets/BD/spritesheet victoire.png", {frameWidth :600, frameHeight: 338});
}
create ()
{
    //this.add.image(400, 300, 'face').setAlpha(0.5);
    this.cursors = this.input.keyboard.createCursorKeys();

    if (this.powerup == 0) {
    this.anims.create({
                key: 'BD_intro',
                frames: this.anims.generateFrameNumbers('animIntro', {start:0,end:104}),
                frameRate: 12,
                repeat: 0
            });
            this.BDintro = this.physics.add.sprite(640, 360, 'animIntro');
            this.BDintro.anims.play('BD_intro', true);
            this.BDintro.setScale(2.131);
        }

    if (this.powerup == 1) {
    this.anims.create({
                key: 'BD_rouefeu',
                frames: this.anims.generateFrameNumbers('animRoueFeu', {start:0,end:46}),
                frameRate: 12,
                repeat: 0
            });

            this.BDroue = this.physics.add.sprite(680, 340, 'animRoueFeu');
            this.BDroue.anims.play('BD_rouefeu', true);
            this.BDroue.setScale(2.131);
    }

    if (this.powerup == 2) {
    this.anims.create({
                key: 'BD_boulefeu',
                frames: this.anims.generateFrameNumbers('animBouleFeu', {start:0,end:46}),
                frameRate: 12,
                repeat: 0
            });

            this.BDboule = this.physics.add.sprite(640, 360, 'animBouleFeu');
            this.BDboule.anims.play('BD_boulefeu', true);
            this.BDboule.setScale(2.131);
    }

    if (this.powerup == 3) {
    this.anims.create({
                key: 'BD_victoire',
                frames: this.anims.generateFrameNumbers('animVictoire', {start:0,end:46}),
                frameRate: 12,
                repeat: 0
            });
            this.BDvictoire = this.physics.add.sprite(640, 360, 'animVictoire');
            this.BDvictoire.anims.play('BD_victoire', true);
            this.BDvictoire.setScale(2.131);
        }

    if (this.powerup == 4) {
    this.anims.create({
                key: 'BD_dcd',
                frames: this.anims.generateFrameNumbers('animDCD', {start:0,end:46}),
                frameRate: 12,
                repeat: 0
            });
            this.BDdcd = this.physics.add.sprite(640, 360, 'animDCD');
            this.BDdcd.anims.play('BD_dcd', true);
            this.BDdcd.setScale(2.131);
        }

    this.change = 0;
}

update () {
    this.change++;
    if (this.powerup == 0) {
        if (this.change > 640) {this.scene.resume('sceneTest'); this.scene.stop();}
    } else {
        if (this.change > 220) {this.scene.resume('sceneTest'); this.scene.stop();}
    }   

}

};

var config = {
        type: Phaser.CANVA,
        width: 1280, height: 720,
        physics: {
        default: 'arcade',
        arcade: {
        debug: false
        }},
        pixelArt: true,
        roundPixels: true,
        scene: [sceneTest, sceneB]
        };

        new Phaser.Game(config);

</script>
</body>
    
</html>